<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>List of Accounts</title>
    <script>
      function confirmDelete(userId) {
        if (confirm("Are you sure you want to delete this account?")) {
          fetch(`/accounts/delete/${userId}/`, {
            method: "POST",
            headers: {
              "X-CSRFToken": getCookie("csrftoken"),
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ id: userId }),
          }).then((response) => {
            if (response.ok) {
              window.location.reload();
            } else {
              alert("An error occurred while deleting.");
            }
          });
        }
      }

      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          const cookies = document.cookie.split(";");
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === name + "=") {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
              break;
            }
          }
        }
        return cookieValue;
      }
    </script>
  </head>
  <body>
    <h1>List of Accounts</h1>
    <table border="1">
      <thead>
        <tr>
          <th>Full Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Roles</th>
          <th>Faculty</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for user_profile in accounts %}
        <tr>
          <td>{{ user_profile.fullname }}</td>
          <td>{{ user_profile.email }}</td>
          <td>{{ user_profile.phone }}</td>
          <td>
            {% for role in user_profile.roles.all %}
              {{ role.name }}{% if not forloop.last %}, {% endif %}
            {% endfor %}
          </td>
          
          <td>{{ user_profile.faculty.name }}</td>
          <td>
            <a href="{% url 'account_edit' user_profile.user.id %}">Edit</a>
            |
            <button onclick="confirmDelete('{{ user_profile.user.id }}')">
              Delete
            </button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </body>
</html>
